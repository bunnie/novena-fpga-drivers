#include <stdint.h>
static const uint16_t table[256] =
  {0, 4129, 8258, 12387, 16516, 20645, 24774, 28903, 33032, 37161, 41290,
  45419, 49548, 53677, 57806, 61935, 4657, 528, 12915, 8786, 21173,
  17044, 29431, 25302, 37689, 33560, 45947, 41818, 54205, 50076, 62463,
  58334, 9314, 13379, 1056, 5121, 25830, 29895, 17572, 21637, 42346,
  46411, 34088, 38153, 58862, 62927, 50604, 54669, 13907, 9842, 5649,
  1584, 30423, 26358, 22165, 18100, 46939, 42874, 38681, 34616, 63455,
  59390, 55197, 51132, 18628, 22757, 26758, 30887, 2112, 6241, 10242,
  14371, 51660, 55789, 59790, 63919, 35144, 39273, 43274, 47403, 23285,
  19156, 31415, 27286, 6769, 2640, 14899, 10770, 56317, 52188, 64447,
  60318, 39801, 35672, 47931, 43802, 27814, 31879, 19684, 23749, 11298,
  15363, 3168, 7233, 60846, 64911, 52716, 56781, 44330, 48395, 36200,
  40265, 32407, 28342, 24277, 20212, 15891, 11826, 7761, 3696, 65439,
  61374, 57309, 53244, 48923, 44858, 40793, 36728, 37256, 33193, 45514,
  41451, 53516, 49453, 61774, 57711, 4224, 161, 12482, 8419, 20484,
  16421, 28742, 24679, 33721, 37784, 41979, 46042, 49981, 54044, 58239,
  62302, 689, 4752, 8947, 13010, 16949, 21012, 25207, 29270, 46570,
  42443, 38312, 34185, 62830, 58703, 54572, 50445, 13538, 9411, 5280,
  1153, 29798, 25671, 21540, 17413, 42971, 47098, 34713, 38840, 59231,
  63358, 50973, 55100, 9939, 14066, 1681, 5808, 26199, 30326, 17941,
  22068, 55628, 51565, 63758, 59695, 39368, 35305, 47498, 43435, 22596,
  18533, 30726, 26663, 6336, 2273, 14466, 10403, 52093, 56156, 60223,
  64286, 35833, 39896, 43963, 48026, 19061, 23124, 27191, 31254, 2801,
  6864, 10931, 14994, 64814, 60687, 56684, 52557, 48554, 44427, 40424,
  36297, 31782, 27655, 23652, 19525, 15522, 11395, 7392, 3265, 61215,
  65342, 53085, 57212, 44955, 49082, 36825, 40952, 28183, 32310, 20053,
  24180, 11923, 16050, 3793, 7920};

  /***----------Table-driven crc function----------***/
  /* Inputs: - size of the character array, the CRC  */
  /*               of which is being computed        */
  /*         - the initial value of the register to  */
  /*               be used in the calculation        */
  /*         - a pointer to the first element of     */
  /*               said character array              */
  /* Outputs: the crc as an unsigned short int       */
int crc16(void *data_p, int size) {
	uint8_t *data = data_p;
	uint16_t crc = 0;
	while(size--) {
		crc = (crc << 8) ^ table[((crc >> 8) ^ *data++) & 0xFFFF];
	}
	return crc;
}


/* Table for CRC-7 (polynomial x^7 + x^3 + 1) */
static const uint8_t crc7_syndrome_table[256] = {
        0x00, 0x09, 0x12, 0x1b, 0x24, 0x2d, 0x36, 0x3f,
        0x48, 0x41, 0x5a, 0x53, 0x6c, 0x65, 0x7e, 0x77,
        0x19, 0x10, 0x0b, 0x02, 0x3d, 0x34, 0x2f, 0x26,
        0x51, 0x58, 0x43, 0x4a, 0x75, 0x7c, 0x67, 0x6e,
        0x32, 0x3b, 0x20, 0x29, 0x16, 0x1f, 0x04, 0x0d,
        0x7a, 0x73, 0x68, 0x61, 0x5e, 0x57, 0x4c, 0x45,
        0x2b, 0x22, 0x39, 0x30, 0x0f, 0x06, 0x1d, 0x14,
        0x63, 0x6a, 0x71, 0x78, 0x47, 0x4e, 0x55, 0x5c,
        0x64, 0x6d, 0x76, 0x7f, 0x40, 0x49, 0x52, 0x5b,
        0x2c, 0x25, 0x3e, 0x37, 0x08, 0x01, 0x1a, 0x13,
        0x7d, 0x74, 0x6f, 0x66, 0x59, 0x50, 0x4b, 0x42,
        0x35, 0x3c, 0x27, 0x2e, 0x11, 0x18, 0x03, 0x0a,
        0x56, 0x5f, 0x44, 0x4d, 0x72, 0x7b, 0x60, 0x69,
        0x1e, 0x17, 0x0c, 0x05, 0x3a, 0x33, 0x28, 0x21,
        0x4f, 0x46, 0x5d, 0x54, 0x6b, 0x62, 0x79, 0x70,
        0x07, 0x0e, 0x15, 0x1c, 0x23, 0x2a, 0x31, 0x38,
        0x41, 0x48, 0x53, 0x5a, 0x65, 0x6c, 0x77, 0x7e,
        0x09, 0x00, 0x1b, 0x12, 0x2d, 0x24, 0x3f, 0x36,
        0x58, 0x51, 0x4a, 0x43, 0x7c, 0x75, 0x6e, 0x67,
        0x10, 0x19, 0x02, 0x0b, 0x34, 0x3d, 0x26, 0x2f,
        0x73, 0x7a, 0x61, 0x68, 0x57, 0x5e, 0x45, 0x4c,
        0x3b, 0x32, 0x29, 0x20, 0x1f, 0x16, 0x0d, 0x04,
        0x6a, 0x63, 0x78, 0x71, 0x4e, 0x47, 0x5c, 0x55,
        0x22, 0x2b, 0x30, 0x39, 0x06, 0x0f, 0x14, 0x1d,
        0x25, 0x2c, 0x37, 0x3e, 0x01, 0x08, 0x13, 0x1a,
        0x6d, 0x64, 0x7f, 0x76, 0x49, 0x40, 0x5b, 0x52,
        0x3c, 0x35, 0x2e, 0x27, 0x18, 0x11, 0x0a, 0x03,
        0x74, 0x7d, 0x66, 0x6f, 0x50, 0x59, 0x42, 0x4b,
        0x17, 0x1e, 0x05, 0x0c, 0x33, 0x3a, 0x21, 0x28,
        0x5f, 0x56, 0x4d, 0x44, 0x7b, 0x72, 0x69, 0x60,
        0x0e, 0x07, 0x1c, 0x15, 0x2a, 0x23, 0x38, 0x31,
        0x46, 0x4f, 0x54, 0x5d, 0x62, 0x6b, 0x70, 0x79
};

static inline uint8_t crc7_byte(uint8_t crc, uint8_t data)
{
        return crc7_syndrome_table[(crc << 1) ^ data];
}

/**
 * crc7 - update the CRC7 for the data buffer
 * @crc:     previous CRC7 value
 * @buffer:  data pointer
 * @len:     number of bytes in the buffer
 * Context: any
 *
 * Returns the updated CRC7 value.
 */
uint8_t crc7(const uint8_t *buffer, int len)
{
	uint8_t crc = 0;
        while (len--)
                crc = crc7_byte(crc, *buffer++);
        return crc;
}
